generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String    @id @default(uuid())
  name            String
  email           String    @unique
  emailVerified   Boolean   @default(false)
  image           String?
  organization    String
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  sessions        Session[]
  accounts        Account[]
  ConvenienceZone ConvenienceZone[]
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  ipAddress String?
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
  id                    String    @id @default(cuid())
  userId                String
  accountId             String
  providerId            String
  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ConvenienceZone {
  id                Int   @id @default(autoincrement())
  name              String
  description       String
  latitude          Float
  longitude         Float
  cbg_list          String[]        // JSON-like array of CBG identifiers
  size              Int
  start_date        DateTime
  length            Int             // Length in hours
  created_at        DateTime @default(now())
  user_id           String
  user              User @relation(references: [id], fields: [user_id], onDelete: Cascade)
  papdata           PaPData?
  patterns          MovementPattern?
  simdata           SimData[]
}

model MovementPattern {
  id                String   @id @default(uuid())
  created_at        DateTime @default(now())
  czone_id          Int @unique
  czone             ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)          
}

model PaPData {
  id            String @id @default(uuid())
  czone_id      Int @unique
  czone         ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)
}

model SimData {
  id            Int @id @default(autoincrement())
  name          String @default("Untitled Run")
  created_at    DateTime @default(now())          
  patterns      String @unique @default(uuid())
  simdata       String @unique @default(uuid())
  czone_id      Int
  czone         ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)
}

model POI {
  id          String  @id @default(uuid())
  latitude    Float
  longitude   Float
  address     String
  cbg         String
  categories  String[]
}