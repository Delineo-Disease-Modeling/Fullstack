generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String      @id @default(uuid())
  name              String
  email             String      @unique
  password_hash     String
  organization      String
  sessions          Session[]
  ConvenienceZone   ConvenienceZone[]
}

model Session {
  id                String        @unique
  user_id           String
  user              User          @relation(references: [id], fields: [user_id], onDelete: Cascade)
  created_at        DateTime      @default(now())
}

model ConvenienceZone {
  id                Int   @id @default(autoincrement())
  name              String
  description       String
  latitude          Float
  longitude         Float
  cbg_list          String[]        // JSON-like array of CBG identifiers
  size              Int
  start_date        DateTime
  length            Int             // Length in hours
  created_at        DateTime @default(now())
  user_id           String
  user              User @relation(references: [id], fields: [user_id], onDelete: Cascade)
  papdata           PaPData?
  patterns          MovementPattern?
  simdata           SimData[]
}

model MovementPattern {
  id                String   @id @default(uuid())
  created_at        DateTime @default(now())
  czone_id          Int @unique
  czone             ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)          
}

model PaPData {
  id            String @id @default(uuid())
  czone_id      Int @unique
  czone         ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)
}

model SimData {
  id            Int @id @default(autoincrement())
  name          String @default("Untitled Run")
  created_at    DateTime @default(now())          
  patterns      String @unique @default(uuid())
  simdata       String @unique @default(uuid())
  czone_id      Int
  czone         ConvenienceZone @relation(references: [id], fields: [czone_id], onDelete: Cascade)
  // Simulation parameters
  hours         Int?
  mask_rate     Float?
  vaccine_rate  Float?
  capacity      Float?
  lockdown      Float?
}

model POI {
  id          String  @id @default(uuid())
  latitude    Float
  longitude   Float
  address     String
  cbg         String
  categories  String[]
}

model RunReport {
  id            Int      @id @default(autoincrement())
  created_at    DateTime @default(now())
  run_type      String   // "cz_generation" or "simulation"
  status        String   // "running", "completed", "failed"
  name          String   // e.g., "CZ Generation: Hagerstown" or "Simulation Run #5"
  
  // Timing
  started_at    DateTime
  completed_at  DateTime?
  duration_ms   Int?
  
  // Links to related records
  czone_id      Int?
  sim_id        Int?
  user_id       String?
  
  // Parameters (JSON string)
  parameters    String?  // JSON: {location, length, interventions, etc.}
  
  // Results summary (JSON string)  
  summary       String?  // JSON: {people_count, infection_rate, etc.}
  
  // Log entries (JSON array string)
  logs          String?  // JSON array: [{timestamp, level, message}, ...]
  
  // Error info if failed
  error         String?
}